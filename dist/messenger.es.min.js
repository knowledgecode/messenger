export let Messenger=parent.Messenger;if(window===parent&&!window.Messenger){const e=()=>Math.random().toString(36).slice(2),t=e(),s={},n={},a={};window.addEventListener("message",e=>{if(e.origin!==location.origin||!e.data||e.data.channel!==t)return;const o=e.data.payload,r=o.id,i=o.topic,d=o.data;switch(e.data.method){case"send":s[i]?a[r].resolve(s[i](d)):a[r].reject();break;case"publish":for(const e of n[i]||[])e(d);a[r].resolve()}delete a[r],e.stopImmediatePropagation()},{capture:!0,passive:!0}),Messenger=class{send(s,n){return new Promise((o,r)=>{const i=e(),d={id:i,topic:s,data:n};a[i]={resolve:o,reject:r},parent.postMessage({channel:t,method:"send",payload:d},location.href)})}bind(e,t){if(!s[e])return s[e]=t,()=>delete s[e]}publish(s,n){return new Promise((o,r)=>{const i=e(),d={id:i,topic:s,data:n};a[i]={resolve:o,reject:r},parent.postMessage({channel:t,method:"publish",payload:d},location.href)})}subscribe(e,t){const s=n[e]=n[e]||[];return s[s.length]=t,()=>{const a=s.indexOf(t);~a&&(s.splice(a,1),s.length||delete n[e])}}},window.Messenger=Messenger}