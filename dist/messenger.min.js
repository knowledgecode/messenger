!function(){"use strict";if(window===parent){var e=function(){return Math.random().toString(36).slice(2)},t=e(),n={},o={},a={};window.addEventListener("message",function(e){if(e.origin===location.origin&&e.data&&e.data.channel===t){var r=e.data.payload,i=r.id,s=r.topic,c=r.data;switch(e.data.method){case"send":n[s]?a[i].resolve(n[s](c)):a[i].reject();break;case"publish":for(var d=0,p=(o[s]||[]).length;d<p;d++)o[s][d](c);a[i].resolve()}delete a[i],e.stopImmediatePropagation()}},{capture:!0,passive:!0});var r=function(){};r.prototype.send=function(n,o){return new Promise(function(r,i){var s=e(),c={id:s,topic:n,data:o};a[s]={resolve:r,reject:i},parent.postMessage({channel:t,method:"send",payload:c},location.href)})},r.prototype.bind=function(e,t){if(!n[e])return n[e]=t,function(){delete n[e]}},r.prototype.publish=function(n,o){return new Promise(function(r,i){var s=e(),c={id:s,topic:n,data:o};a[s]={resolve:r,reject:i},parent.postMessage({channel:t,method:"publish",payload:c},location.href)})},r.prototype.subscribe=function(e,t){var n=o[e]=o[e]||[];return n[n.length]=t,function(){var a=n.indexOf(t);~a&&(n.splice(a,1),n.length||delete o[e])}},window.Messenger=r}else window.Messenger=parent.Messenger}();