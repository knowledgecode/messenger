!function(){"use strict";if(window===parent){var e=function(){return Math.random().toString(36).slice(2)},t=e(),n={},o={},i={},a=function(e){return e instanceof Promise?e:Promise.resolve(e)},r=queueMicrotask||setImmediate||function(e){Promise.resolve().then(e)};window.addEventListener("message",function(e){if(e.origin===location.origin&&e.data&&e.data.channel===t){e.stopImmediatePropagation();var s=e.data.payload,c=s.id||"",u=s.topic,d=s.data,p=s.timeout||0;switch(e.data.method){case"send":var f=i[c];n[u]?(p>0?Promise.race([a(n[u](d)),new Promise(function(e,t){setTimeout(t,p)})]):a(n[u](d))).then(function(e){f.resolve(e)}).catch(function(e){f.reject(e)}):f.reject(),delete i[c];break;case"publish":!function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])}(o[u]||[],function(e){r(function(){e(d)})})}}},{capture:!0,passive:!0});var s=function(){};s.prototype.send=function(n,o,a){return new Promise(function(r,s){var c=e(),u={id:c,topic:n,data:o,timeout:a||0};i[c]={resolve:r,reject:s},parent.postMessage({channel:t,method:"send",payload:u},location.origin)})},s.prototype.bind=function(e,t){if(!n[e])return n[e]=t,function(){delete n[e]}},s.prototype.publish=function(e,n){parent.postMessage({channel:t,method:"publish",payload:{topic:e,data:n}},location.origin)},s.prototype.subscribe=function(e,t){var n=o[e]=o[e]||[];return n[n.length]=t,function(){var i=n.indexOf(t);~i&&(n.splice(i,1),n.length||delete o[e])}},window.messenger=new s}else window.messenger=parent.messenger}();