!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).messenger=n()}(this,(function(){"use strict";
/**
     * @preserve messenger (c) KNOWLEDGECODE | MIT
     */var e=parent.messenger;if(window===parent&&!e){var n=function(){return Math.random().toString(36).slice(2)},t=n(),o="file://"===location.origin||"null"===location.origin?"*":location.origin,i="*"===o?"null":o,r={},a={},s={},c=function(e){return e instanceof Promise?e:Promise.resolve(e)},u=queueMicrotask||setImmediate||function(e){Promise.resolve().then(e)};window.addEventListener("message",(function(e){if(e.origin===i&&e.data&&e.data.channel===t){e.stopImmediatePropagation();var n=e.data.payload,o=n.id||"",d=n.topic,f=n.data,l=n.timeout||0;switch(e.data.method){case"send":var p=s[o];r[d]?(l>0?Promise.race([c(r[d](f)),new Promise((function(e,n){setTimeout(n,l)}))]):c(r[d](f))).then((function(e){p.resolve(e)})).catch((function(e){p.reject(e)})):p.reject(),delete s[o];break;case"publish":!function(e,n){for(var t=0,o=e.length;t<o;t++)n(e[t])}(a[d]||[],(function(e){u((function(){e(f)}))}))}}}),{capture:!0,passive:!0});var d=function(){};d.prototype.send=function(e,i,r){return new Promise((function(a,c){var u=n(),d={id:u,topic:e,data:i,timeout:r||0};s[u]={resolve:a,reject:c},parent.postMessage({channel:t,method:"send",payload:d},o)}))},d.prototype.bind=function(e,n){if(!r[e])return r[e]=n,function(){delete r[e]}},d.prototype.publish=function(e,n){parent.postMessage({channel:t,method:"publish",payload:{topic:e,data:n}},o)},d.prototype.subscribe=function(e,n){var t=a[e]=a[e]||[];return t[t.length]=n,function(){var o=t.indexOf(n);~o&&(t.splice(o,1),t.length||delete a[e])}},e=window.messenger=new d}return e}));
