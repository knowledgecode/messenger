!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).messenger=t()}(this,(function(){"use strict";
/**
     * @preserve messenger (c) KNOWLEDGECODE | MIT
     */var e=parent.messenger;if(window===parent&&!e){var t=function(){return Math.random().toString(36).slice(2)},n=t(),o="file://"===location.origin?"*":location.origin,i="*"===o?"null":o,r={},a={},s={},c=function(e){return e instanceof Promise?e:Promise.resolve(e)},u=queueMicrotask||setImmediate||function(e){Promise.resolve().then(e)};window.addEventListener("message",(function(e){if(e.origin===i&&e.data&&e.data.channel===n){e.stopImmediatePropagation();var t=e.data.payload,o=t.id||"",d=t.topic,f=t.data,p=t.timeout||0;switch(e.data.method){case"send":var l=s[o];r[d]?(p>0?Promise.race([c(r[d](f)),new Promise((function(e,t){setTimeout(t,p)}))]):c(r[d](f))).then((function(e){l.resolve(e)})).catch((function(e){l.reject(e)})):l.reject(),delete s[o];break;case"publish":!function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])}(a[d]||[],(function(e){u((function(){e(f)}))}))}}}),{capture:!0,passive:!0});var d=function(){};d.prototype.send=function(e,i,r){return new Promise((function(a,c){var u=t(),d={id:u,topic:e,data:i,timeout:r||0};s[u]={resolve:a,reject:c},parent.postMessage({channel:n,method:"send",payload:d},o)}))},d.prototype.bind=function(e,t){if(!r[e])return r[e]=t,function(){delete r[e]}},d.prototype.publish=function(e,t){parent.postMessage({channel:n,method:"publish",payload:{topic:e,data:t}},o)},d.prototype.subscribe=function(e,t){var n=a[e]=a[e]||[];return n[n.length]=t,function(){var o=n.indexOf(t);~o&&(n.splice(o,1),n.length||delete a[e])}},e=window.messenger=new d}return e}));
