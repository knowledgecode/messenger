/**
 * @preserve messenger (c) KNOWLEDGECODE | MIT
 */
var e=parent.messenger;if(window===parent&&!e){var t=function(){return Math.random().toString(36).slice(2)},n=t(),o="file://"===location.origin?"*":location.origin,i="*"===o?"null":o,a={},r={},s={},c=function(e){return e instanceof Promise?e:Promise.resolve(e)},u=queueMicrotask||setImmediate||function(e){Promise.resolve().then(e)};window.addEventListener("message",(function(e){if(e.origin===i&&e.data&&e.data.channel===n){e.stopImmediatePropagation();var t=e.data.payload,o=t.id||"",d=t.topic,p=t.data,l=t.timeout||0;switch(e.data.method){case"send":var f=s[o];a[d]?(l>0?Promise.race([c(a[d](p)),new Promise((function(e,t){setTimeout(t,l)}))]):c(a[d](p))).then((function(e){f.resolve(e)})).catch((function(e){f.reject(e)})):f.reject(),delete s[o];break;case"publish":!function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])}(r[d]||[],(function(e){u((function(){e(p)}))}))}}}),{capture:!0,passive:!0});var d=function(){};d.prototype.send=function(e,i,a){return new Promise((function(r,c){var u=t(),d={id:u,topic:e,data:i,timeout:a||0};s[u]={resolve:r,reject:c},parent.postMessage({channel:n,method:"send",payload:d},o)}))},d.prototype.bind=function(e,t){if(!a[e])return a[e]=t,function(){delete a[e]}},d.prototype.publish=function(e,t){parent.postMessage({channel:n,method:"publish",payload:{topic:e,data:t}},o)},d.prototype.subscribe=function(e,t){var n=r[e]=r[e]||[];return n[n.length]=t,function(){var o=n.indexOf(t);~o&&(n.splice(o,1),n.length||delete r[e])}},e=window.messenger=new d}var p=e;export default p;
