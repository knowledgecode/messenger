/**
 * @preserve messenger (c) KNOWLEDGECODE | MIT
 */
var e=parent.messenger;if(window===parent&&!e){var n=function(){return Math.random().toString(36).slice(2)},t=n(),o="file://"===location.origin||"null"===location.origin?"*":location.origin,i="*"===o?"null":o,a={},r={},s={},c=function(e){return e instanceof Promise?e:Promise.resolve(e)},u=window.queueMicrotask||window.setImmediate||function(e){Promise.resolve().then(e)};window.addEventListener("message",(function(e){if(("*"===o||e.origin===i)&&e.data&&e.data.channel===t){e.stopImmediatePropagation();var n=e.data.payload,d=n.id||"",l=n.topic,p=n.data,f=n.timeout||0;switch(e.data.method){case"send":var m=s[d];a[l]?(f>0?Promise.race([c(a[l](p)),new Promise((function(e,n){setTimeout(n,f)}))]):c(a[l](p))).then((function(e){m.resolve(e)})).catch((function(e){m.reject(e)})):m.reject(),delete s[d];break;case"publish":!function(e,n){for(var t=0,o=e.length;t<o;t++)n(e[t])}(r[l]||[],(function(e){u((function(){e(p)}))}))}}}),{capture:!0,passive:!0});var d=function(){};d.prototype.send=function(e,i,a){return new Promise((function(r,c){var u=n(),d={id:u,topic:e,data:i,timeout:a||0};s[u]={resolve:r,reject:c},parent.postMessage({channel:t,method:"send",payload:d},o)}))},d.prototype.bind=function(e,n){if(!a[e])return a[e]=n,function(){delete a[e]}},d.prototype.publish=function(e,n){parent.postMessage({channel:t,method:"publish",payload:{topic:e,data:n}},o)},d.prototype.subscribe=function(e,n){var t=r[e]=r[e]||[];return t[t.length]=n,function(){var o=t.indexOf(n);~o&&(t.splice(o,1),t.length||delete r[e])}},e=window.messenger=new d}var l=e;export default l;
